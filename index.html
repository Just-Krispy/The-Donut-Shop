<script>
    // ... (previous code)

    let customerEmail, contactNumber, optIn;

    function askForDonutOrder() {
        rl.question("Please specify the type of donut you want or type 'done' to complete your order: ", (type) => {
            if (type.toLowerCase() === 'done') {
                console.log("Agent: Thank you for stopping by Krispy's Donut Shop!");
                rl.close();
            } else {
                donutType = type;
                rl.question("How many donuts would you like to order? ", (quantity) => {
                    donutQuantity = quantity;

                    // Continue the conversation
                    console.log(`Agent: Thank you for waiting, ${customerName}. I am checking the order status for you.`);
                    const orderStatus = "In Progress"; // You can change this to "Delayed" or "Shipped"
                    console.log(`Agent: Your order status is: ${orderStatus}`);
                    console.log(`Agent: You have ordered ${donutQuantity} ${donutType} donut(s).`);

                    // Ask for customer email
                    rl.question("Please enter your email address: ", (email) => {
                        customerEmail = email;
                        // Ask for contact number and opt-in status
                        rl.question("Please enter your contact number: ", (number) => {
                            contactNumber = number;
                            rl.question("Do you want to opt in to receive messages for orders and updates? (Y/N): ", (response) => {
                                optIn = response.toLowerCase() === 'y';
                                console.log(`Agent: We will send order updates to ${customerEmail}.`);
                                if (optIn) {
                                    console.log(`Agent: We will also send updates to ${contactNumber}.`);
                                } else {
                                    console.log(`Agent: You have opted out of receiving messages at ${contactNumber}.`);
                                }
                                console.log("Agent: Thank you for stopping by Krispy's Donut Shop!");
                                rl.close();
                            });
                        });
                    });
                });
            }
        });
    }

    // Start the chat
    rl.question("Are you checking an existing order or would you like to place a new order? (Enter 'existing' or 'new'): ", (choice) => {
        if (choice.toLowerCase() === 'existing') {
            // Handle existing order logic here
            // You can continue with name, customer number, order number, etc.
        } else if (choice.toLowerCase() === 'new') {
            // Handle new order logic here
            // Ask for customer name
            rl.question("Please enter your name: ", (name) => {
                customerName = name;
                askForDonutOrder();
            });
        } else {
            console.log("Agent: Invalid choice. Please enter 'existing' or 'new'.");
            rl.close();
        }
    });
</script>
